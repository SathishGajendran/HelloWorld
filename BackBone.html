<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Backbone</title>
</head>
<body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>

    <div id="mydiv">Loading...</div>
    <div>
        <ul>
            <li><a href="#home">HomeRoute</a></li>
            <li><a href="#data/1/2">Value from query String</a></li>
            <li><a href="#method">Method call from route</a></li>
            <li><a href="#path/asdf/asdf">Url Fragment</a></li>
            <li><a href="#asdf">invalidRoute</a></li>
        </ul>
    </div>
    <canvas id="gradCanvas" height="500" width="200" style="border: 1px solid;"></canvas>
    <script type="text/template" id="mytemplate">
        <h1>templateContent</h1>
        <h4><%=data%></h4>
        <input type="button" id="mybutton" value="viewButton" />
        <input type="text" id="mytextbox" />
    </script>

    <script type="text/javascript">
        //$(document).ready(function () {
        //    var Canvas = $('#gradCanvas')[0];
        //    var PrevX, PrevY, CanvasClick = false;
        //    Canvas.onmousedown = function (e) {
        //        CanvasClick = true;
        //        PrevX = e.offsetX;
        //        PrevY = e.offsetY;
        //    };
        //    Canvas.onmousemove = function (e) {
        //        if (CanvasClick) {
        //            Draw(PrevX, PrevY, e.offsetX, e.offsetY);
        //            PrevX = e.offsetX;
        //            PrevY = e.offsetY;
        //        }
        //    };
        //    Canvas.onmouseup = function (e) {
        //        CanvasClick = false;
        //    };
        //    function Draw(PrevX, PrevY, CurrentX, CurrentY) {
        //        var CanvasContext = Canvas.getContext('2d');
        //        CanvasContext.fillStyle = "red";
        //       // CanvasContext.fillRect(0, PrevY, 0, CurrentY);
        //    }
        //});

        var Model = Backbone.Model.extend({
            initialize: function () {
                alert("model created");
            },
            defaults: {
                name: "name",
                id: 0,
                data1: null,
                data2: null
            },
            modelFunction: function (value) {
                this.set({
                    data1: value1,
                    data2: value2
                });
            },
            validate: function () {
                alert('validation');
            }
        });
        var Collection = Backbone.Collection.extend({
            model: Model,
            //   localStorage: new Store("data"),
            initialize: function () {
                alert("collection created");
            }
        });
        var View = Backbone.View.extend({
            initialize: function () {
                this.render();

            },
            name: null,
            render: function () {
                var template = _.template($("#mytemplate").html(), { data: "mydata" });
                this.$el.html(template);
            },
            events: {
                "click input[id=mybutton]": function () {
                    //  alert('hi');
                    //Backbone.history.navigate('method', true);
                    if (window.location.hash == "#home") {
                        window.location.hash = "data/2/2";
                    } else {
                        window.location.hash = "home";
                    }
                },
                "keyup input[id=mytextbox]": "textChange"
                // "click #gradDiv": "GradDiv"

            },
            textChange: function (e) {
                console.log(this.name);
                alert(e.target.value);
            },
            GradDiv: function () {
                alert("hi");
            }
        });

        var Router = Backbone.Router.extend({
            initialize: function () {
                alert('router created');
            },
            routes: {
                "home": "homeRoute",
                "data/:data1/:data2": "data",
                "dataTest/:id": "dataTest",
                "method": "onMethod",
                "path/*path": "pathTest",
                ":route/:action": "action",
                "*action": "invalidRoute"
            },
            homeRoute: function () {
                var model = new Model();
                model.set({ name: "name1", id: 1 });
                var collection = new Collection([model]);
                var view = new View({ el: $("#mydiv"), name: model.get("name") });
            },
            dataTest: function (id) {
                alert(id);
            },
            data: function (data1, data2) {
                alert(data1 + ' ' + data2);
            },
            invalidRoute: function (action) {
                alert("Invalid Route");
                console.log(action);
            }
        });

        var router = new Router();
        router.on("route:onMethod", function () {
            alert("method");
        });
        router.on("route:pathTest", function (path) {
            alert(path);
        });
        router.on("route:action", function (route, view) {
            alert(route + ' ' + view);
        });
        Backbone.history.start();
    </script>

    <script type="text/javascript" src="canvas.js"></script>
</body>
</html>
